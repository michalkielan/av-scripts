#!/bin/bash

mkdir -p "h265"

total=$(find . -maxdepth 1 -type f -name '*MOV' | wc -l)
i=1

for f in *.MOV
do
  echo "${f} ${i}/${total}"
  ffmpeg -hwaccel auto -i "${f}" -c:v hevc_nvenc -preset slow -cq 17 -qp 22 -rc constqp -c:a pcm_s16le -map_metadata 0 "h265/${f}" -loglevel info
  if [ $? -ne 0 ]; then
    echo "Error: ffmpeg failed"
    exit 1
  fi
  ((i++))
done
